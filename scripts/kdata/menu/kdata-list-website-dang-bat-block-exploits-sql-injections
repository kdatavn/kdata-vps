#!/bin/bash
. /home/kdata.conf
echo "-------------------------------------------------------------------------"
echo "Please wait ..."
sleep 1
rm -rf /tmp/*kdata*
mkdir -p /tmp/sitedangbatsqlinjectkdata
ls /etc/nginx/conf.d > /tmp/kdata-websitelist
sed -i 's/\.conf//g' /tmp/kdata-websitelist 
sowebsitetrenserver=$(cat /tmp/kdata-websitelist | wc -l)
sowebsite=$(cat /tmp/kdata-websitelist)
for website in $sowebsite 
do
if [ -f /etc/nginx/conf.d/$website.conf ]; then
if [ "$(grep block.conf /etc/nginx/conf.d/$website.conf)" == "include /etc/nginx/conf/block.conf;" ]; then
touch /tmp/sitedangbatsqlinjectkdata/$website
fi
fi
if [ -f /etc/nginx/conf.d/www.$website.conf ]; then
if [ "$(grep block.conf /etc/nginx/conf.d/www.$website.conf)" == "include /etc/nginx/conf/block.conf;" ]; then
touch /tmp/sitedangbatsqlinjectkdata/www.$website
fi
fi
done
clear
echo "========================================================================="
echo "Website on server: $sowebsitetrenserver"
echo "-------------------------------------------------------------------------"
if [ "$(ls -1 /tmp/sitedangbatsqlinjectkdata | wc -l)" == "0" ]; then
echo "Website ENABLED [Block Exploits, SQL Injections]: 0"
else
echo "Website ENABLED [Block Exploits, SQL Injections]: $(ls -1 /tmp/sitedangbatsqlinjectkdata | wc -l)"
echo "-------------------------------------------------------------------------"
ls /tmp/sitedangbatsqlinjectkdata | pr -3 -t
fi
/etc/kdata/menu/kdata-tien-ich
